
<!DOCTYPE html>
<html>
  <head>
    <title>Surf</title>
    <style>
      * {
        box-sizing: border-box;
      }

      :root {
        font-size: 10px;
        --background-color: #2ca8b4;
        --outline-color: #3a2e1b;
        --details-color: #fff7d5;
        --fur-color: #ffa621;
      }

      body {
        background-color: var(--background-color);
        color: var(--outline-color);
        font-family: "Lucida Console";
        height: 100vh;
        margin: 0;
        overflow: hidden;
        position: relative;
      }

      #wrapper {
        display: flex;
        height: 100%;
        padding: 0.8rem 1.6rem;
        justify-content: space-between;
      }

      #keys {
        display: flex;
        -webkit-user-select: none;
        -webkit-app-region: drag;
      }

      #movement-keys {
        column-gap: 0.2rem;
        display: grid;
        grid-template-areas: 
          "j w c"
          "a s d";
        grid-template-columns: repeat(3, calc(50vh - 1rem));
        grid-template-rows: repeat(2, calc(50% - 0.2rem));
        margin-right: 1.6rem;
        row-gap: 0.4rem;
      }

      #other-keys {
        align-content: flex-end;
        display: grid;
        grid-template-columns: repeat(2, calc(50vh - 1rem));
        grid-template-rows: calc(50% - 0.2rem);
        column-gap: 0.2rem;
      }

      .key {
        height: 100%;
        position: relative;
        width: 100%;
      }

      .key span {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;

        background-color: var(--details-color);
        border-radius: 5px;
        font-weight: bold;
        font-size: 1.6rem;
        font-variant: small-caps;
        text-align: center;
        width: 100%;
        height: 100%;
        line-height: calc(100vh / 2 - 1rem);

        box-shadow:
          0 0.2rem 0 0.1rem var(--outline-color), 
          0 -0.1rem 0 0 var(--outline-color);
      }

      .key.active span {
        background-color: var(--fur-color);
        box-shadow:
          0 0 0 0.1rem var(--outline-color);
        top: 0.2rem;
      }

      #key-w {
        grid-area: w;
      }

      #key-a {
        grid-area: a;
      }

      #key-s {
        grid-area: s;
      }

      #key-d {
        grid-area: d;
      }

      #text {
        align-content: center;
        display: flex;
        font-size: 1.6rem;
      }

      #now-playing {
        align-items: center;
        display: flex;
      }

      #stupid-gif,
      #album-art {
        display: block;
        height: calc(100vh - 1.6rem);
        width: calc(100vh - 1.6rem);
      }

      #song-info {
        height: 100%;
        background-color: var(--details-color);
        color: var(--outline-color);
        font-size: 16px;
        padding: 0 1.6rem;
        text-shadow: 0 1px 0 var();
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      #song-name {
        font-size: 16px;
        font-weight: bold;
      }

      #artists-names {
        margin-top: 5px;
        font-size: 14px;
      }

      #status {
        align-self: center;
        box-shadow: 0 0 0 0.1rem var(--outline-color);
        background-color: var(--details-color);
        border-radius: 5px;
        font-weight: bold;
        font-size: 1.6rem;
        line-height: calc(100vh / 2 - 0.8rem);
        padding: 0 1.6rem;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <div id="wrapper">
      <div id="keys">
        <div id="movement-keys">
          <div id="key-w" class="key"><span>W</span></div>
          <div id="key-a" class="key"><span>A</span></div>
          <div id="key-s" class="key"><span>S</span></div>
          <div id="key-d" class="key"><span>D</span></div>
        </div>
        <div id="other-keys">
          <div id="key-ctrl" class="key"><span>C</span></div>
          <div id="key-jump" class="key"><span>J</span></div>
        </div>
      </div>
      <!-- <div id="text">
        <div id="status" contenteditable="true">Map: None</div>
      </div> -->
      <div id="now-playing">
        <div><img src="goshdarnheck_logo.rc1.2.2.png" id="album-art" style="display: none" /></div>
        <div id="song-info">
          <div id="song-name">[No song]</div>
          <div id="artists-names" style="display: none"></div>
        </div>
        <div><img src="catjam0.gif" id="stupid-gif" /></div>
      </div>
    </div>
    <script>
      const ipcRenderer = require('electron').ipcRenderer;
      
      ipcRenderer.on('globalkeydown', (event, message) => {
        switch (message.keycode) {
          case 17:
            document.getElementById('key-w').classList.add('active');
            break;
          case 30:
            document.getElementById('key-a').classList.add('active');
            break;
          case 31:
            document.getElementById('key-s').classList.add('active');
            break;
          case 32:
            document.getElementById('key-d').classList.add('active');
            break;
          case 29:
            document.getElementById('key-ctrl').classList.add('active');
            break;
          case 57:
            document.getElementById('key-jump').classList.add('active');
            setTimeout(() => {
              document.getElementById('key-jump').classList.remove('active');
            }, 120)
            break;
        }
      });

      ipcRenderer.on('globalkeyup', (event, message) => {
        switch (message.keycode) {
          case 17:
            document.getElementById('key-w').classList.remove('active');
            break;
          case 30:
            document.getElementById('key-a').classList.remove('active');
            break;
          case 31:
            document.getElementById('key-s').classList.remove('active');
            break;
          case 32:
            document.getElementById('key-d').classList.remove('active');
            break;
          case 29:
            document.getElementById('key-ctrl').classList.remove('active');
            break;
        }
      });

      ipcRenderer.on('globalwheel', (event, message) => {
        if (message.rotation === -1) {
          document.getElementById('key-jump').classList.add('active');
          setTimeout(() => {
            document.getElementById('key-jump').classList.remove('active');
          }, 120)
        }
      })

      const setNoSong = () => {
        document.getElementById('album-art').style.display = 'none';
        document.getElementById('stupid-gif').setAttribute('src', 'catjam0.gif');
        document.getElementById('song-name').innerHTML = '[No song]';
        document.getElementById('artists-names').innerHTML = ''
        document.getElementById('artists-names').style.display = 'none';
      }

      ipcRenderer.on('currentTrack', (event, message) => {
        if (message && message.body && message.body.item) {
          const item = message.body.item;
          const artUrl = item.album.images[item.album.images.length - 1].url
          const artistsString = item.artists.map((artist) => artist.name).join(', ');

          if (message.body.is_playing) {
            document.getElementById('song-name').innerHTML = item.name;
            document.getElementById('album-art').setAttribute('src', artUrl);
            document.getElementById('album-art').style.display = 'block';
            document.getElementById('stupid-gif').setAttribute('src', 'catjam.gif');
            document.getElementById('artists-names').innerHTML = artistsString
            document.getElementById('artists-names').style.display = 'inline'
          } else {
            setNoSong()
          }
        } else {
          setNoSong()
        }
      })
    </script>
  </body>
</html>